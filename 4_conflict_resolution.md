# Day 4｜衝突處理

## ⚡ **前言**
學會了分支協作和基本合併，但在實際團隊開發中，當多人修改同一份檔案時，就會遇到合併衝突。今天我們要深入學習如何識別、分析和解決各種衝突情況。

---

## 🔍 一、衝突產生原因與分析

### 1.1 什麼時候會發生合併衝突？
合併衝突是多人協作中無法避免的情況，主要發生在：

- **同一行修改**：多人修改同一檔案的同一行代碼
- **檔案操作衝突**：一人新增檔案，另一人刪除同名檔案
- **移動與修改**：檔案移動與內容修改同時發生
- **格式化差異**：不同編輯器的行尾符號或編碼差異

### 1.2 衝突識別與解決

#### 衝突識別
- **Sourcetree 顯示**：
  - 在檔案列表中顯示 ⚠️ 衝突標記（Conflicted files）
  - 狀態列顯示「Merge in progress」狀態
  - 衝突檔案會以特殊圖示標示
  - 無法進行新的 commit 直到解決所有衝突

#### 衝突解決
1. **手動編輯**：選擇要保留的內容
2. **移除標記**：刪除 `<<<<<<<`、`=======`、`>>>>>>>`
3. **標記解決**：在 Sourcetree 中標記為已解決
4. **完成合併**：執行 commit 完成合併

---

## 🛠 二、衝突解決工具設定

### 2.1 設定外部合併工具

#### 在 Sourcetree 中設定 KDiff3
1. 開啟 Sourcetree 偏好設定
2. 選擇「Diff」頁籤
3. 外部 Diff 工具選擇「KDiff3」
4. 合併工具也選擇「KDiff3」
5. 點擊「OK」儲存設定

#### 其他推薦的合併工具
- **Beyond Compare**：功能強大，支援多種檔案格式
- **VS Code**：內建優秀的 diff 和 merge 功能
- **P4Merge**：Perforce 提供的免費工具
- **Meld**：跨平台的開源工具

### 2.2 識別和定位衝突

#### Sourcetree 中的衝突顯示
當發生衝突時，Sourcetree 會：
- 在檔案列表中顯示 ⚠️ 衝突標記（Conflicted files）
- 狀態列顯示「Merge in progress」狀態
- 衝突檔案會以特殊圖示標示
- 無法進行新的 commit 直到解決所有衝突

#### 實際衝突處理範例
**發生衝突的情境**：
- 兩個分支同時修改了同一個檔案
- Sourcetree 會停止合併並顯示衝突狀態
- 需要手動解決衝突才能繼續

#### 衝突檔案的標記格式
```
<<<<<<< HEAD
目前分支的內容（你的修改）
=======
要合併分支的內容（其他人的修改）
>>>>>>> feature/new-function
```

---

## 🛠 三、實際衝突解決操作

### 3.1 使用 KDiff3 解決衝突

#### 啟動 KDiff3
1. 在 Sourcetree 中右鍵點擊衝突檔案
2. 選擇「Resolve Conflicts」→「Launch External Merge Tool」
3. KDiff3 會自動開啟顯示三方比較

#### KDiff3 介面說明
- **左側窗口**：目前分支版本（BASE）
- **中間窗口**：共同祖先版本（ANCESTOR）
- **右側窗口**：要合併的分支版本（OTHER）
- **下方窗口**：合併結果（OUTPUT）

#### 手動解決衝突步驟
1. **分析差異**：檢視三個版本的不同處
2. **選擇保留**：
   - 點擊「A」保留左側版本
   - 點擊「B」保留右側版本
   - 點擊「C」保留中間版本
3. **手動編輯**：直接在下方編輯最終版本
4. **儲存結果**：完成後儲存並關閉 KDiff3

### 3.2 常見衝突類型的解決策略

#### 代碼邏輯衝突
```javascript
// 衝突例子：函式參數驗證
<<<<<<< HEAD
if (password.length < 6) {
    return "密碼太短";
}
=======
if (password.length < 8) {
    return "密碼強度不足";
}
>>>>>>> feature/stronger-password
```

**解決策略**：
- 與團隊討論決定標準
- 可能需要整合兩個需求

👉 下一篇：[Day 5｜忽略檔案管理](5_ignore_files.md)
